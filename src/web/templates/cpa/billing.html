{% extends "cpa/base.html" %}

{% block title %}Billing{% endblock %}
{% block page_title %}Billing & Subscription{% endblock %}

{% block extra_styles %}
<style>
    .billing-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 24px;
        margin-bottom: 32px;
    }

    @media (max-width: 768px) {
        .billing-grid {
            grid-template-columns: 1fr;
        }
    }

    .plan-card {
        background: var(--white);
        border-radius: 16px;
        border: 2px solid var(--primary-color);
        overflow: hidden;
    }

    .plan-header {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        padding: 24px;
        text-align: center;
    }

    .plan-name {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 4px;
    }

    .plan-status {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 12px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        font-size: 0.85rem;
    }

    .plan-body {
        padding: 24px;
    }

    .plan-price {
        text-align: center;
        margin-bottom: 24px;
    }

    .plan-price-amount {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--text-dark);
    }

    .plan-price-period {
        color: var(--text-muted);
    }

    .plan-features {
        list-style: none;
        margin-bottom: 24px;
    }

    .plan-features li {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 0;
        border-bottom: 1px solid var(--border-color);
    }

    .plan-features li:last-child {
        border-bottom: none;
    }

    .plan-features .check {
        color: var(--success);
    }

    .usage-card {
        background: var(--white);
        border-radius: 16px;
        border: 1px solid var(--border-color);
        padding: 24px;
    }

    .usage-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .usage-title {
        font-weight: 600;
        font-size: 1.1rem;
    }

    .usage-period {
        font-size: 0.85rem;
        color: var(--text-muted);
    }

    .usage-bar-container {
        background: var(--bg-light);
        border-radius: 8px;
        height: 12px;
        overflow: hidden;
        margin-bottom: 12px;
    }

    .usage-bar {
        height: 100%;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        border-radius: 8px;
        transition: width 0.5s ease;
    }

    .usage-stats {
        display: flex;
        justify-content: space-between;
        font-size: 0.9rem;
    }

    .usage-current {
        font-weight: 600;
        color: var(--primary-color);
    }

    .usage-limit {
        color: var(--text-muted);
    }

    .billing-section {
        background: var(--white);
        border-radius: 12px;
        border: 1px solid var(--border-color);
        margin-bottom: 24px;
    }

    .billing-section-header {
        padding: 20px 24px;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .billing-section-title {
        font-weight: 600;
        font-size: 1.1rem;
    }

    .billing-section-body {
        padding: 24px;
    }

    .payment-method {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 16px;
        background: var(--bg-light);
        border-radius: 12px;
    }

    .card-icon {
        width: 48px;
        height: 32px;
        background: linear-gradient(135deg, #1a1f71, #00579f);
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 0.75rem;
    }

    .card-details {
        flex: 1;
    }

    .card-number {
        font-weight: 500;
    }

    .card-expiry {
        font-size: 0.85rem;
        color: var(--text-muted);
    }

    .invoice-table {
        width: 100%;
        border-collapse: collapse;
    }

    .invoice-table th {
        text-align: left;
        padding: 12px 0;
        font-weight: 600;
        font-size: 0.85rem;
        color: var(--text-muted);
        border-bottom: 2px solid var(--border-color);
    }

    .invoice-table td {
        padding: 16px 0;
        border-bottom: 1px solid var(--border-color);
    }

    .invoice-status {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
    }

    .invoice-status.paid {
        background: #d1fae5;
        color: #065f46;
    }

    .invoice-status.pending {
        background: #fef3c7;
        color: #92400e;
    }
</style>
{% endblock %}

{% block content %}
<div class="billing-grid">
    <div class="plan-card">
        <div class="plan-header">
            <div class="plan-name">{{ billing.plan }}</div>
            <span class="plan-status">✓ {{ billing.status|capitalize }}</span>
        </div>
        <div class="plan-body">
            <div class="plan-price">
                <span class="plan-price-amount">${{ billing.amount }}</span>
                <span class="plan-price-period">/month</span>
            </div>
            <ul class="plan-features">
                <li><span class="check">✓</span> Up to {{ billing.leads_limit }} leads/month</li>
                <li><span class="check">✓</span> Lead scoring & prioritization</li>
                <li><span class="check">✓</span> Custom branding</li>
                <li><span class="check">✓</span> Analytics dashboard</li>
                <li><span class="check">✓</span> Email notifications</li>
            </ul>
            <button class="btn btn-secondary" style="width: 100%;">Change Plan</button>
        </div>
    </div>

    <div class="usage-card">
        <div class="usage-header">
            <div class="usage-title">Leads Usage</div>
            <div class="usage-period">This Month</div>
        </div>
        <div class="usage-bar-container">
            <div class="usage-bar" style="width: {{ (billing.leads_this_month / billing.leads_limit * 100)|int }}%;"></div>
        </div>
        <div class="usage-stats">
            <span class="usage-current">{{ billing.leads_this_month }} leads used</span>
            <span class="usage-limit">{{ billing.leads_limit }} limit</span>
        </div>
        <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border-color);">
            <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                <span style="color: var(--text-muted);">Next billing date</span>
                <span style="font-weight: 500;">{{ billing.next_billing }}</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span style="color: var(--text-muted);">Amount due</span>
                <span style="font-weight: 500;">${{ billing.amount }}</span>
            </div>
        </div>
    </div>
</div>

<div class="billing-section">
    <div class="billing-section-header">
        <h3 class="billing-section-title">Payment Method</h3>
        <button class="btn btn-secondary btn-sm">Update</button>
    </div>
    <div class="billing-section-body">
        <div class="payment-method">
            <div class="card-icon">VISA</div>
            <div class="card-details">
                <div class="card-number">•••• •••• •••• 4242</div>
                <div class="card-expiry">Expires 12/27</div>
            </div>
        </div>
    </div>
</div>

<div class="billing-section">
    <div class="billing-section-header">
        <h3 class="billing-section-title">Billing History</h3>
        <button class="btn btn-secondary btn-sm">Download All</button>
    </div>
    <div class="billing-section-body" style="padding: 0 24px 24px;">
        <table class="invoice-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Description</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Jan 1, 2026</td>
                    <td>Professional Plan - January</td>
                    <td>${{ billing.amount }}</td>
                    <td><span class="invoice-status paid">✓ Paid</span></td>
                    <td><a href="#" style="color: var(--primary-color);">Download</a></td>
                </tr>
                <tr>
                    <td>Dec 1, 2025</td>
                    <td>Professional Plan - December</td>
                    <td>${{ billing.amount }}</td>
                    <td><span class="invoice-status paid">✓ Paid</span></td>
                    <td><a href="#" style="color: var(--primary-color);">Download</a></td>
                </tr>
                <tr>
                    <td>Nov 1, 2025</td>
                    <td>Professional Plan - November</td>
                    <td>${{ billing.amount }}</td>
                    <td><span class="invoice-status paid">✓ Paid</span></td>
                    <td><a href="#" style="color: var(--primary-color);">Download</a></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
