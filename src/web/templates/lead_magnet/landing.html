{% from 'macros/icons.html' import icon %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Tax Savings Analysis | {{ cpa.firm_name or cpa.display_name }}</title>
    <meta name="description" content="Discover how much you could save on taxes. Get a free personalized analysis from {{ cpa.display_name }}.">
    <meta name="robots" content="index, follow">
    {% set shared_score = request.query_params.get('score') if request else None %}
    {% set share_image_url = '/lead-magnet/share-card.svg?score=' ~ (shared_score or '58') ~ '&cpa=' ~ (cpa.cpa_slug or 'default') %}
    <meta property="og:title" content="Tax Health Score | {{ cpa.firm_name or cpa.display_name }}">
    <meta property="og:description" content="Check your Tax Health Score and missed savings range in under 2 minutes.">
    <meta property="og:image" content="{{ share_image_url }}">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Tax Health Score">
    <meta name="twitter:description" content="Check your score and savings opportunities in minutes.">
    <meta name="twitter:image" content="{{ share_image_url }}">
    {% if cpa.favicon_url %}
    <link rel="icon" href="{{ cpa.favicon_url }}">
    {% endif %}
    <link rel="stylesheet" href="/static/css/core/variables.css">
    <link rel="stylesheet" href="/static/css/core/reset.css">
    <link rel="stylesheet" href="/static/css/core/typography.css">
    <link rel="stylesheet" href="/static/css/unified-theme.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: {{ cpa.primary_color or '#1e3a5f' }};
            --secondary-color: {{ cpa.secondary_color or '#152b47' }};
            --accent-color: {{ cpa.accent_color or '#10b981' }};
            --text-dark: var(--color-gray-800);
            --text-muted: var(--color-gray-500);
            --bg-light: var(--color-gray-50);
            --white: var(--white);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: var(--leading-relaxed);

            color: var(--text-dark);
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: var(--space-5);
        }

        /* Trust Bar */
        .trust-bar {
            background: rgba(255, 255, 255, 0.95);
            padding: var(--space-3) var(--space-5);
            border-radius: var(--radius-xl);
            margin-bottom: var(--space-6);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-6);
            flex-wrap: wrap;
            font-size: 13px;
            color: var(--color-gray-600);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .trust-item {
            display: flex;
            align-items: center;
            gap: var(--space-1-5);
        }

        .trust-icon {
            width: 18px;
            height: 18px;
        }

        .trust-icon.shield { color: var(--color-success-500); }
        .trust-icon.check { color: var(--color-primary-400); }
        .trust-icon.lock { color: var(--color-primary-400); }

        /* Hero Card */
        .hero-card {
            background: var(--white);
            border-radius: 20px;
            padding: 50px var(--space-10);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .cpa-branding {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-4);
            margin-bottom: 30px;
        }

        .cpa-logo {
            max-width: 60px;
            max-height: 60px;
            border-radius: var(--radius-lg);
        }

        .cpa-info {
            text-align: left;
        }

        .cpa-name {
            font-size: 1.1rem;
            font-weight: var(--font-semibold);
            color: var(--text-dark);
        }

        .cpa-firm {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .cpa-credentials {
            display: inline-flex;
            gap: var(--space-1-5);
            margin-top: var(--space-1);
        }

        .credential-badge {
            font-size: 0.7rem;
            padding: var(--space-0-5) var(--space-2);

            background: var(--primary-color);
            color: white;
            border-radius: 10px;
            font-weight: var(--font-semibold);
        }

        /* Value Proposition */
        .value-prop {
            background: linear-gradient(135deg, var(--accent-color) 0%, var(--color-success-600) 100%);
            color: white;
            padding: var(--space-5) 30px;
            border-radius: var(--radius-2xl);
            margin-bottom: 30px;
        }

        .value-amount {
            font-size: 2.5rem;
            font-weight: var(--font-bold);
        }

        .value-text {
            font-size: 1rem;
            opacity: 0.95;
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: var(--space-4);
            color: var(--text-dark);
            font-weight: var(--font-bold);
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--text-muted);
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Benefits Grid */
        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-5);
            margin-bottom: 30px;
        }

        .benefit-item {
            text-align: center;
            padding: var(--space-5) 15px;
            background: var(--bg-light);
            border-radius: var(--radius-xl);
        }

        .benefit-icon {
            font-size: 2rem;
            margin-bottom: var(--space-2-5);
        }

        .benefit-title {
            font-weight: var(--font-semibold);
            color: var(--text-dark);
            margin-bottom: var(--space-1-5);
        }

        .benefit-desc {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* CTA Button */
        .cta-button {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 18px 50px;
            border-radius: 50px;
            text-decoration: none;
            font-size: 1.2rem;
            font-weight: var(--font-semibold);
            transition: transform 0.2s, box-shadow 0.2s;
            border: none;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.4);
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(37, 99, 235, 0.5);
        }

        .cta-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .cta-subtext {
            margin-top: var(--space-3);
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* Time Estimate */
        .time-estimate {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1-5);
            background: var(--color-warning-100);
            color: var(--color-warning-800);
            padding: var(--space-2) var(--space-4);
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: var(--font-medium);
            margin-bottom: var(--space-5);
        }

        .deadline-banner {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            border-radius: var(--radius-full);
            padding: var(--space-2) var(--space-3-5);
            font-size: 0.82rem;
            font-weight: var(--font-semibold);
            margin-bottom: 18px;
        }

        .deadline-banner.critical {
            background: var(--color-error-100);
            color: var(--color-error-800);
        }

        .deadline-banner.high {
            background: var(--color-warning-100);
            color: var(--color-warning-800);
        }

        .deadline-banner.moderate {
            background: var(--color-info-100);
            color: #1d4ed8;
        }

        .deadline-banner.planning {
            background: #dcfce7;
            color: var(--color-success-700);
        }

        /* What You'll Get Section */
        .what-youll-get {
            margin-top: var(--space-10);
            padding-top: 30px;
            border-top: 1px solid var(--color-gray-200);
        }

        .section-title {
            font-size: 1.1rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--space-5);
        }

        .get-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-4);
            text-align: left;
        }

        .get-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-3);
            padding: var(--space-4);
            background: var(--bg-light);
            border-radius: var(--radius-xl);
        }

        .get-item-icon {
            flex-shrink: 0;
            width: var(--space-8);

            height: var(--space-8);

            background: var(--primary-color);
            color: white;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .get-item-text h4 {
            font-weight: var(--font-semibold);
            margin-bottom: var(--space-1);
        }

        .get-item-text p {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* Disclaimer */
        .disclaimer {
            margin-top: 30px;
            padding: var(--space-4) var(--space-5);
            background: var(--color-gray-100);
            border-radius: 10px;
            font-size: 0.75rem;
            color: var(--color-gray-500);
            text-align: left;
            border-left: 3px solid var(--color-gray-300);
        }

        .disclaimer strong {
            color: var(--color-gray-700);
        }

        /* Loading State */
        .loading {
            display: none;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--space-2-5);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .hero-card {
                padding: 30px var(--space-5);
            }

            h1 {
                font-size: 1.7rem;
            }

            .subtitle {
                font-size: 1rem;
            }

            .benefits-grid {
                grid-template-columns: 1fr;
                gap: var(--space-3);
            }

            .trust-bar {
                flex-direction: column;
                gap: var(--space-2-5);
                padding: var(--space-4);
            }

            .get-items {
                grid-template-columns: 1fr;
            }

            .value-amount {
                font-size: 2rem;
            }

            .cta-button {
                padding: var(--space-4) var(--space-10);
                font-size: 1.1rem;
            }

            .cpa-branding {
                flex-direction: column;
                text-align: center;
            }

            .cpa-info {
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Trust Bar -->
        <div class="trust-bar" role="banner" aria-label="Trust indicators">
            <div class="trust-item">
                <svg class="trust-icon shield" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    <path d="M9 12l2 2 4-4"/>
                </svg>
                <span>Bank-Level Encryption</span>
            </div>
            <div class="trust-item">
                <svg class="trust-icon check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M9 12l2 2 4-4"/>
                </svg>
                <span>Licensed CPA</span>
            </div>
            <div class="trust-item">
                <svg class="trust-icon lock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                    <path d="M7 11V7a5 5 0 0110 0v4"/>
                </svg>
                <span>Your Data Never Sold</span>
            </div>
        </div>

        <!-- Hero Card -->
        <div class="hero-card">
            <!-- CPA Branding -->
            <div class="cpa-branding">
                {% if cpa.logo_url %}
                <img src="{{ cpa.logo_url }}" alt="{{ cpa.firm_name }}" class="cpa-logo">
                {% endif %}
                <div class="cpa-info">
                    <div class="cpa-name">{{ cpa.display_name }}</div>
                    {% if cpa.firm_name %}
                    <div class="cpa-firm">{{ cpa.firm_name }}</div>
                    {% endif %}
                    <div class="cpa-credentials">
                        {% for credential in cpa.credentials %}
                        <span class="credential-badge">{{ credential }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Value Proposition -->
            <div class="value-prop">
                <div class="value-amount">$2,847</div>
                <div class="value-text">Average tax savings identified for our clients</div>
            </div>

            <!-- Time Estimate -->
            <div class="time-estimate">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                </svg>
                Just 4 quick questions (under 2 minutes)
            </div>

            <div class="deadline-banner {{ deadline_context.urgency if deadline_context else 'moderate' }}">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                </svg>
                <span>
                    Tax deadline in {{ deadline_context.days_remaining if deadline_context else 60 }} days
                </span>
            </div>

            <h1 id="heroHeadline">You May Be Overpaying the IRS This Year</h1>
            <p class="subtitle" id="heroSubtitle">
                In under 2 minutes, get your personalized Tax Health Score and see
                where missed deductions, credits, and timing strategies may be costing you.
            </p>

            <!-- Benefits Grid -->
            <div class="benefits-grid">
                <div class="benefit-item">
                    <div class="benefit-icon">{{ icon('banknotes') }}</div>
                    <div class="benefit-title">Find Hidden Savings</div>
                    <div class="benefit-desc">See the missed savings range before booking a call</div>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon">{{ icon('chart-bar') }}</div>
                    <div class="benefit-title">Tax Health Score</div>
                    <div class="benefit-desc">Benchmark your optimization level on a 100-point scale</div>
                </div>
                <div class="benefit-item">
                    <div class="benefit-icon">{{ icon('sparkles') }}</div>
                    <div class="benefit-title">Expert Guidance</div>
                    <div class="benefit-desc">Get a CPA review path with your local firm branding</div>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <div>Starting your analysis...</div>
            </div>

            <!-- CTA Button -->
            <button onclick="startAssessment()" class="cta-button" id="start-button">
                <span id="heroCtaText">Check My Tax Health Score</span>
            </button>
            <div class="cta-subtext">
                Free for now. Tax deadline pressure makes timing matter.
            </div>

            <!-- What You'll Get -->
            <div class="what-youll-get">
                <div class="section-title">What You'll Get</div>
                <div class="get-items">
                    <div class="get-item">
                        <div class="get-item-icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                                <polyline points="22 4 12 14.01 9 11.01"/>
                            </svg>
                        </div>
                        <div class="get-item-text">
                            <h4>Savings Estimate</h4>
                            <p>See how much you could potentially save</p>
                        </div>
                    </div>
                    <div class="get-item">
                        <div class="get-item-icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                                <polyline points="14 2 14 8 20 8"/>
                            </svg>
                        </div>
                        <div class="get-item-text">
                            <h4>Tax Insights Report</h4>
                            <p>Personalized recommendations for your situation</p>
                        </div>
                    </div>
                    <div class="get-item">
                        <div class="get-item-icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>
                            </svg>
                        </div>
                        <div class="get-item-text">
                            <h4>Free Consultation Option</h4>
                            <p>Speak with a CPA about your specific needs</p>
                        </div>
                    </div>
                    <div class="get-item">
                        <div class="get-item-icon">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                        </div>
                        <div class="get-item-text">
                            <h4>Tax Calendar Reminders</h4>
                            <p>Key dates you need to know</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Disclaimer -->
            <div class="disclaimer">
                <strong>Important Disclosure:</strong> This analysis tool provides educational
                information about potential tax-saving opportunities based on general tax principles.
                The estimates provided are for informational purposes only and do not constitute
                tax advice. Actual savings depend on your complete financial situation and may vary.
                For personalized tax advice, please consult with {{ cpa.display_name }} or a
                qualified tax professional. By proceeding, you agree to our
                <a href="/privacy" target="_blank">Privacy Policy</a> and
                <a href="/terms" target="_blank">Terms of Service</a>.
            </div>
        </div>
    </div>

    <script src="/static/js/lead_magnet_analytics.js"></script>
    <script>
        // Get CPA slug from URL or use default
        const urlParams = new URLSearchParams(window.location.search);
        const cpaSlug = urlParams.get('cpa') || '{{ cpa.cpa_slug }}';
        const serverVariant = '{{ variant_id or "A" }}';
        const experimentConfig = window.LeadMagnetAnalytics
            ? window.LeadMagnetAnalytics.getExperimentConfig(serverVariant)
            : {
                variant_id: serverVariant,
                phone_capture_variant: 'optional',
                gate_aggressiveness: 'soft',
                score_visualization: 'donut',
                teaser_cta: 'unlock_report'
            };
        const heroVariants = {
            A: {
                headline: 'You May Be Overpaying the IRS by $X,XXX',
                subtitle: 'Answer 4 quick questions to reveal your Tax Health Score and hidden savings range.',
                cta: 'Check My Tax Health Score'
            },
            B: {
                headline: 'Most Taxpayers Score Below 60/100',
                subtitle: 'See how your tax setup compares and what to fix before filing season closes.',
                cta: 'Reveal My Score'
            },
            C: {
                headline: 'Found: Missed Tax Strategies in Minutes',
                subtitle: 'Get a personalized savings estimate before you book any CPA consultation.',
                cta: 'Find My Missed Savings'
            },
            D: {
                headline: 'How Healthy Is Your Tax Setup?',
                subtitle: 'Get a benchmarked Tax Health Score with strategy opportunities for your profile.',
                cta: 'Run My 2-Minute Check'
            },
            E: {
                headline: 'Tax Deadline Pressure Is Real',
                subtitle: 'Use this rapid assessment to see if you are still leaving money on the table.',
                cta: 'Start Free Assessment'
            }
        };
        const variantKeys = Object.keys(heroVariants);
        const selectedVariant = experimentConfig.variant_id || (window.LeadMagnetAnalytics
            ? window.LeadMagnetAnalytics.resolveVariant(serverVariant)
            : (variantKeys.includes((urlParams.get('v') || '').toUpperCase()) ? (urlParams.get('v') || '').toUpperCase() : serverVariant));

        function applyHeroVariant() {
            const variant = heroVariants[selectedVariant] || heroVariants.A;
            const headlineEl = document.getElementById('heroHeadline');
            const subtitleEl = document.getElementById('heroSubtitle');
            const ctaEl = document.getElementById('heroCtaText');
            const sharedScore = urlParams.get('score');
            if (urlParams.get('share') === '1' && sharedScore && headlineEl && subtitleEl) {
                headlineEl.textContent = `A Friend Shared a ${sharedScore}/100 Tax Health Score`;
                subtitleEl.textContent = 'Run your own 2-minute check and compare where your savings opportunities stand.';
                if (ctaEl) ctaEl.textContent = 'Check My Score Now';
                return;
            }
            if (headlineEl) headlineEl.textContent = variant.headline;
            if (subtitleEl) subtitleEl.textContent = variant.subtitle;
            if (ctaEl) ctaEl.textContent = variant.cta;
        }

        function trackLeadMagnetEvent(sessionId, eventName, step, metadata = {}) {
            if (!sessionId || !window.LeadMagnetAnalytics) return;
            window.LeadMagnetAnalytics.trackEvent(
                sessionId,
                eventName,
                step || null,
                {
                    ...metadata,
                    cpa_slug: cpaSlug,
                },
                { defaultVariant: selectedVariant }
            );
            window.LeadMagnetAnalytics.safeGtag(eventName, {
                step: step || undefined,
                cpa_slug: cpaSlug,
                hero_variant: selectedVariant,
            });
        }

        function getReferralSource() {
            const directRef = urlParams.get('ref');
            if (directRef) return directRef;
            if (document.referrer) return document.referrer;
            return 'direct';
        }

        function getUtmContext() {
            if (!window.LeadMagnetAnalytics) {
                return {
                    utm_source: urlParams.get('utm_source'),
                    utm_medium: urlParams.get('utm_medium'),
                    utm_campaign: urlParams.get('utm_campaign'),
                    device_type: null
                };
            }
            return window.LeadMagnetAnalytics.getCommonContext(selectedVariant);
        }

        async function startAssessment() {
            const button = document.getElementById('start-button');
            const loading = document.getElementById('loading');

            try {
                // Disable button and show loading
                button.disabled = true;
                button.style.opacity = '0.6';
                loading.classList.add('show');

                const attribution = getUtmContext();
                let response;
                if (window.LeadMagnetAnalytics) {
                    response = await window.LeadMagnetAnalytics.startAssessment(
                        cpaSlug,
                        'quick',
                        getReferralSource(),
                        { defaultVariant: selectedVariant }
                    );
                } else {
                    response = await fetch('/api/cpa/lead-magnet/start', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            cpa_slug: cpaSlug,
                            assessment_mode: 'quick',
                            referral_source: getReferralSource(),
                            variant_id: selectedVariant,
                            utm_source: attribution.utm_source || null,
                            utm_medium: attribution.utm_medium || null,
                            utm_campaign: attribution.utm_campaign || null,
                            device_type: attribution.device_type || null
                        })
                    });
                }

                if (!response.ok) {
                    throw new Error('Failed to start assessment');
                }

                const data = await response.json();

                // Store session ID
                if (window.LeadMagnetAnalytics) {
                    window.LeadMagnetAnalytics.cacheStartSession(data);
                } else {
                    sessionStorage.setItem('assessment_session_id', data.session_id);
                    sessionStorage.setItem('cpa_profile', JSON.stringify(data.cpa_profile));
                }

                // Track start before redirecting to next step
                trackLeadMagnetEvent(data.session_id, 'start', 'welcome', {
                    assessment_mode: 'quick',
                    referral_source: getReferralSource(),
                    hero_variant: selectedVariant,
                    phone_capture_variant: experimentConfig.phone_capture_variant,
                    gate_aggressiveness: experimentConfig.gate_aggressiveness,
                    score_visualization: experimentConfig.score_visualization,
                    teaser_cta: experimentConfig.teaser_cta,
                    shared_score: urlParams.get('score') || null
                });

                // Redirect to quick estimate form
                window.location.href = `/lead-magnet/estimate?session=${data.session_id}`;

            } catch (error) {
                console.error('Failed to start assessment:', error);
                alert('Unable to start assessment. Please try again.');

                // Re-enable button
                button.disabled = false;
                button.style.opacity = '1';
                loading.classList.remove('show');
            }
        }

        // Track page view for analytics
        document.addEventListener('DOMContentLoaded', function() {
            applyHeroVariant();
            if (window.LeadMagnetAnalytics) {
                window.LeadMagnetAnalytics.safeGtag('view', {
                    cpa_slug: cpaSlug,
                    hero_variant: selectedVariant
                });
            } else if (typeof gtag === 'function') {
                gtag('event', 'lead_magnet_view', { cpa_slug: cpaSlug, hero_variant: selectedVariant });
            }
            console.log('Lead magnet landing page loaded for CPA:', cpaSlug);
        });
    </script>
</body>
</html>
