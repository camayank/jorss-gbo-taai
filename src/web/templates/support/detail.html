{% extends "base_modern.html" %}

{% block title %}Ticket #TKT-2024-0147 - {{ config.APP_NAME }}{% endblock %}

{% block extra_css %}
<style>
    .ticket-detail-page {
        padding: var(--space-6);
        max-width: 1200px;
        margin: 0 auto;
    }

    .page-header {
        margin-bottom: var(--space-6);
    }

    .breadcrumb {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        font-size: var(--text-sm);
        color: var(--color-gray-500);
        margin-bottom: var(--space-2);
    }

    .breadcrumb a {
        color: var(--color-primary-600);
        text-decoration: none;
    }

    .breadcrumb a:hover {
        text-decoration: underline;
    }

    .ticket-title-row {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: var(--space-4);
    }

    .ticket-title {
        font-size: var(--text-xl);
        font-weight: var(--font-semibold);
        color: var(--color-gray-900);
    }

    .ticket-id {
        font-size: var(--text-sm);
        color: var(--color-gray-500);
        margin-top: var(--space-1);
    }

    .ticket-actions {
        display: flex;
        gap: var(--space-2);
    }

    .btn {
        display: inline-flex;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-2) var(--space-4);
        border-radius: var(--radius-md);
        font-size: var(--text-sm);
        font-weight: var(--font-medium);
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        text-decoration: none;
    }

    .btn-primary {
        background: var(--color-primary-600);
        color: white;
    }

    .btn-primary:hover {
        background: var(--color-primary-700);
    }

    .btn-secondary {
        background: white;
        color: var(--color-gray-700);
        border: 1px solid var(--color-gray-300);
    }

    .btn-secondary:hover {
        background: var(--color-gray-50);
    }

    .btn-success {
        background: var(--color-success-600);
        color: white;
    }

    .btn-success:hover {
        background: var(--color-success-700);
    }

    /* Layout */
    .ticket-layout {
        display: grid;
        grid-template-columns: 1fr 320px;
        gap: var(--space-6);
    }

    /* Conversation Thread */
    .conversation-card {
        background: white;
        border-radius: var(--radius-lg);
        border: 1px solid var(--color-gray-200);
        overflow: hidden;
    }

    .conversation-header {
        padding: var(--space-4) var(--space-6);
        border-bottom: 1px solid var(--color-gray-200);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .conversation-title {
        font-size: var(--text-sm);
        font-weight: var(--font-semibold);
        color: var(--color-gray-900);
    }

    .message-count {
        font-size: var(--text-xs);
        color: var(--color-gray-500);
    }

    .conversation-thread {
        max-height: 600px;
        overflow-y: auto;
    }

    .message {
        padding: var(--space-4) var(--space-6);
        border-bottom: 1px solid var(--color-gray-100);
    }

    .message:last-child {
        border-bottom: none;
    }

    .message.staff {
        background: var(--color-primary-50);
    }

    .message-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-3);
    }

    .message-author {
        display: flex;
        align-items: center;
        gap: var(--space-3);
    }

    .author-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--text-sm);
        font-weight: var(--font-medium);
    }

    .author-avatar.user {
        background: var(--color-gray-200);
        color: var(--color-gray-700);
    }

    .author-avatar.staff {
        background: var(--color-primary-600);
        color: white;
    }

    .author-info {
        display: flex;
        flex-direction: column;
    }

    .author-name {
        font-size: var(--text-sm);
        font-weight: var(--font-medium);
        color: var(--color-gray-900);
    }

    .author-role {
        font-size: var(--text-xs);
        color: var(--color-gray-500);
    }

    .message-time {
        font-size: var(--text-xs);
        color: var(--color-gray-500);
    }

    .message-content {
        font-size: var(--text-sm);
        color: var(--color-gray-700);
        line-height: 1.6;
    }

    .message-content p {
        margin-bottom: var(--space-3);
    }

    .message-content p:last-child {
        margin-bottom: 0;
    }

    .message-attachments {
        margin-top: var(--space-3);
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-2);
    }

    .attachment-chip {
        display: inline-flex;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-2) var(--space-3);
        background: var(--color-gray-100);
        border-radius: var(--radius-md);
        font-size: var(--text-xs);
        color: var(--color-gray-700);
        text-decoration: none;
        transition: background 0.2s;
    }

    .attachment-chip:hover {
        background: var(--color-gray-200);
    }

    /* Reply Form */
    .reply-form {
        padding: var(--space-4) var(--space-6);
        border-top: 1px solid var(--color-gray-200);
        background: var(--color-gray-50);
    }

    .reply-textarea {
        width: 100%;
        padding: var(--space-3);
        border: 1px solid var(--color-gray-300);
        border-radius: var(--radius-md);
        font-size: var(--text-sm);
        min-height: 100px;
        resize: vertical;
        font-family: inherit;
        margin-bottom: var(--space-3);
    }

    .reply-textarea:focus {
        outline: none;
        border-color: var(--color-primary-500);
        box-shadow: 0 0 0 3px var(--color-primary-100);
    }

    .reply-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .reply-options {
        display: flex;
        gap: var(--space-2);
    }

    .option-btn {
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: var(--radius-md);
        border: 1px solid var(--color-gray-300);
        background: white;
        cursor: pointer;
        color: var(--color-gray-500);
        transition: all 0.2s;
    }

    .option-btn:hover {
        background: var(--color-gray-100);
        color: var(--color-gray-700);
    }

    /* Sidebar */
    .sidebar {
        display: flex;
        flex-direction: column;
        gap: var(--space-6);
    }

    .sidebar-card {
        background: white;
        border-radius: var(--radius-lg);
        border: 1px solid var(--color-gray-200);
        overflow: hidden;
    }

    .sidebar-header {
        padding: var(--space-4);
        border-bottom: 1px solid var(--color-gray-200);
        font-size: var(--text-sm);
        font-weight: var(--font-semibold);
        color: var(--color-gray-900);
    }

    .sidebar-content {
        padding: var(--space-4);
    }

    .detail-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-2) 0;
    }

    .detail-row:not(:last-child) {
        border-bottom: 1px solid var(--color-gray-100);
    }

    .detail-label {
        font-size: var(--text-sm);
        color: var(--color-gray-500);
    }

    .detail-value {
        font-size: var(--text-sm);
        font-weight: var(--font-medium);
        color: var(--color-gray-900);
    }

    .status-badge {
        padding: var(--space-1) var(--space-2);
        border-radius: var(--radius-full);
        font-size: var(--text-xs);
        font-weight: var(--font-medium);
    }

    .status-badge.open {
        background: var(--color-primary-100);
        color: var(--color-primary-700);
    }

    .status-badge.pending {
        background: var(--color-warning-100);
        color: var(--color-warning-700);
    }

    .status-badge.resolved {
        background: var(--color-success-100);
        color: var(--color-success-700);
    }

    .priority-badge {
        padding: var(--space-1) var(--space-2);
        border-radius: var(--radius-full);
        font-size: var(--text-xs);
        font-weight: var(--font-medium);
    }

    .priority-badge.high {
        background: var(--color-error-100);
        color: var(--color-error-700);
    }

    .priority-badge.medium {
        background: var(--color-warning-100);
        color: var(--color-warning-700);
    }

    .priority-badge.low {
        background: var(--color-gray-100);
        color: var(--color-gray-700);
    }

    .category-badge {
        padding: var(--space-1) var(--space-2);
        border-radius: var(--radius-full);
        font-size: var(--text-xs);
        font-weight: var(--font-medium);
        background: var(--color-accent-100);
        color: var(--color-accent-700);
    }

    /* User Info */
    .user-info {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        padding: var(--space-4);
    }

    .user-avatar-lg {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: var(--color-gray-200);
        color: var(--color-gray-700);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--text-lg);
        font-weight: var(--font-medium);
    }

    .user-details {
        flex: 1;
    }

    .user-name {
        font-size: var(--text-sm);
        font-weight: var(--font-medium);
        color: var(--color-gray-900);
    }

    .user-email {
        font-size: var(--text-xs);
        color: var(--color-gray-500);
    }

    .user-actions {
        padding: 0 var(--space-4) var(--space-4);
    }

    .user-action-btn {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        width: 100%;
        padding: var(--space-2);
        border: none;
        background: transparent;
        font-size: var(--text-sm);
        color: var(--color-gray-600);
        cursor: pointer;
        border-radius: var(--radius-md);
        transition: all 0.2s;
    }

    .user-action-btn:hover {
        background: var(--color-gray-100);
        color: var(--color-gray-900);
    }

    /* Activity Log */
    .activity-list {
        display: flex;
        flex-direction: column;
    }

    .activity-item {
        display: flex;
        gap: var(--space-3);
        padding: var(--space-3) var(--space-4);
        border-bottom: 1px solid var(--color-gray-100);
    }

    .activity-item:last-child {
        border-bottom: none;
    }

    .activity-icon {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        background: var(--color-gray-100);
        color: var(--color-gray-500);
    }

    .activity-content {
        flex: 1;
        min-width: 0;
    }

    .activity-text {
        font-size: var(--text-xs);
        color: var(--color-gray-700);
    }

    .activity-time {
        font-size: var(--text-xs);
        color: var(--color-gray-400);
        margin-top: var(--space-1);
    }

    /* Responsive */
    @media (max-width: 1024px) {
        .ticket-layout {
            grid-template-columns: 1fr;
        }

        .sidebar {
            order: -1;
            flex-direction: row;
            overflow-x: auto;
        }

        .sidebar-card {
            min-width: 280px;
        }
    }

    @media (max-width: 768px) {
        .ticket-detail-page {
            padding: var(--space-4);
        }

        .ticket-title-row {
            flex-direction: column;
        }

        .ticket-actions {
            width: 100%;
        }

        .ticket-actions .btn {
            flex: 1;
            justify-content: center;
        }

        .sidebar {
            flex-direction: column;
        }

        .sidebar-card {
            min-width: auto;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="ticket-detail-page">
    <div class="page-header">
        <div class="breadcrumb">
            <a href="/support/tickets">Support</a>
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M9 5l7 7-7 7"/>
            </svg>
            <span>Ticket Details</span>
        </div>
        <div class="ticket-title-row">
            <div>
                <h1 class="ticket-title">Unable to upload documents - Error 500</h1>
                <div class="ticket-id">#TKT-2024-0147</div>
            </div>
            <div class="ticket-actions">
                <button class="btn btn-secondary">
                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                    Edit
                </button>
                <button class="btn btn-success">
                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                        <path d="M22 4L12 14.01l-3-3"/>
                    </svg>
                    Mark Resolved
                </button>
            </div>
        </div>
    </div>

    <div class="ticket-layout">
        <!-- Conversation Thread -->
        <div class="conversation-card">
            <div class="conversation-header">
                <span class="conversation-title">Conversation</span>
                <span class="message-count">3 messages</span>
            </div>
            <div class="conversation-thread">
                <!-- Original Message -->
                <div class="message">
                    <div class="message-header">
                        <div class="message-author">
                            <span class="author-avatar user">JD</span>
                            <div class="author-info">
                                <span class="author-name">John Doe</span>
                                <span class="author-role">Client</span>
                            </div>
                        </div>
                        <span class="message-time">Jan 28, 2026 at 10:23 AM</span>
                    </div>
                    <div class="message-content">
                        <p>I'm trying to upload my W-2 forms but keep getting an error message that says "Error 500 - Internal Server Error".</p>
                        <p>I've tried multiple times with different browsers (Chrome and Firefox) but the same error happens. The file is a PDF and is only 1.2MB in size, so it shouldn't be a file size issue.</p>
                        <p>Can you please help me resolve this? I need to upload these documents to proceed with my tax filing.</p>
                    </div>
                    <div class="message-attachments">
                        <a href="#" class="attachment-chip">
                            <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                                <path d="M14 2v6h6"/>
                            </svg>
                            screenshot_error.png
                        </a>
                    </div>
                </div>

                <!-- Staff Response -->
                <div class="message staff">
                    <div class="message-header">
                        <div class="message-author">
                            <span class="author-avatar staff">ST</span>
                            <div class="author-info">
                                <span class="author-name">Support Team</span>
                                <span class="author-role">Staff</span>
                            </div>
                        </div>
                        <span class="message-time">Jan 28, 2026 at 11:45 AM</span>
                    </div>
                    <div class="message-content">
                        <p>Hi John,</p>
                        <p>Thank you for reaching out. I apologize for the inconvenience you're experiencing with the document upload feature.</p>
                        <p>I've checked our system logs and found that there was a temporary issue with our upload service that has now been resolved. Could you please try uploading your document again?</p>
                        <p>If you continue to experience issues, please let me know and I'll escalate this to our technical team for further investigation.</p>
                    </div>
                </div>

                <!-- Follow-up Message -->
                <div class="message">
                    <div class="message-header">
                        <div class="message-author">
                            <span class="author-avatar user">JD</span>
                            <div class="author-info">
                                <span class="author-name">John Doe</span>
                                <span class="author-role">Client</span>
                            </div>
                        </div>
                        <span class="message-time">Jan 28, 2026 at 12:15 PM</span>
                    </div>
                    <div class="message-content">
                        <p>I just tried again and I'm still getting the same error. The upload progress shows 100% but then the error appears.</p>
                        <p>Is there anything else I can try?</p>
                    </div>
                </div>
            </div>

            <!-- Reply Form -->
            <div class="reply-form">
                <textarea class="reply-textarea" placeholder="Type your reply here..."></textarea>
                <div class="reply-actions">
                    <div class="reply-options">
                        <button class="option-btn" title="Attach file">
                            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48"/>
                            </svg>
                        </button>
                        <button class="option-btn" title="Insert template">
                            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                                <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
                            </svg>
                        </button>
                    </div>
                    <button class="btn btn-primary">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                        </svg>
                        Send Reply
                    </button>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Ticket Details -->
            <div class="sidebar-card">
                <div class="sidebar-header">Ticket Details</div>
                <div class="sidebar-content">
                    <div class="detail-row">
                        <span class="detail-label">Status</span>
                        <span class="status-badge open">Open</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Priority</span>
                        <span class="priority-badge high">High</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Category</span>
                        <span class="category-badge">Technical</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Created</span>
                        <span class="detail-value">Jan 28, 2026</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Last Update</span>
                        <span class="detail-value">2 hours ago</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Assigned To</span>
                        <span class="detail-value">Support Team</span>
                    </div>
                </div>
            </div>

            <!-- Requester -->
            <div class="sidebar-card">
                <div class="sidebar-header">Requester</div>
                <div class="user-info">
                    <span class="user-avatar-lg">JD</span>
                    <div class="user-details">
                        <div class="user-name">John Doe</div>
                        <div class="user-email">john.doe@example.com</div>
                    </div>
                </div>
                <div class="user-actions">
                    <button class="user-action-btn">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        View Profile
                    </button>
                    <button class="user-action-btn">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                            <path d="M22 6l-10 7L2 6"/>
                        </svg>
                        Send Email
                    </button>
                    <button class="user-action-btn">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                            <path d="M14 2v6h6"/>
                        </svg>
                        View All Tickets (5)
                    </button>
                </div>
            </div>

            <!-- Activity Log -->
            <div class="sidebar-card">
                <div class="sidebar-header">Activity Log</div>
                <div class="activity-list">
                    <div class="activity-item">
                        <div class="activity-icon">
                            <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>
                            </svg>
                        </div>
                        <div class="activity-content">
                            <div class="activity-text">John Doe replied to the ticket</div>
                            <div class="activity-time">2 hours ago</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">
                            <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>
                            </svg>
                        </div>
                        <div class="activity-content">
                            <div class="activity-text">Support Team replied to the ticket</div>
                            <div class="activity-time">3 hours ago</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">
                            <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                                <circle cx="8.5" cy="7" r="4"/>
                                <path d="M20 8v6M23 11h-6"/>
                            </svg>
                        </div>
                        <div class="activity-content">
                            <div class="activity-text">Ticket assigned to Support Team</div>
                            <div class="activity-time">4 hours ago</div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">
                            <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                        </div>
                        <div class="activity-content">
                            <div class="activity-text">Ticket created by John Doe</div>
                            <div class="activity-time">4 hours ago</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
