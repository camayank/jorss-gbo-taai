{#
  Modal Component

  Dialog/modal overlay for focused interactions.

  Usage:
    {% from 'components/layout/modal.html' import modal, confirm_modal, drawer %}

    {% call modal(id="my-modal", title="Edit Profile") %}
      <form>...</form>
    {% endcall %}

  Parameters (modal):
    - id: Unique identifier (required)
    - title: Modal title (required)
    - size: sm|md|lg|xl|full (default: md)
    - show_close: Show close button (default: true)
    - footer_actions: List of button configs (optional)
    - class_name: Additional CSS classes (optional)

  Note: Requires JavaScript to toggle .active class
#}

{% macro modal(
  id,
  title,
  size='md',
  show_close=true,
  footer_actions=[],
  class_name=''
) %}
  <!-- Modal Backdrop -->
  <div class="modal-backdrop" id="{{ id }}-backdrop" onclick="closeModal('{{ id }}')"></div>

  <!-- Modal Container -->
  <div class="modal modal-{{ size }} {{ class_name }}" id="{{ id }}" role="dialog" aria-modal="true" aria-labelledby="{{ id }}-title">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="{{ id }}-title">{{ title }}</h2>
        {% if show_close %}
          <button type="button" class="modal-close" onclick="closeModal('{{ id }}')" aria-label="Close">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6 6 18M6 6l12 12"/>
            </svg>
          </button>
        {% endif %}
      </div>

      <div class="modal-body">
        {{ caller() }}
      </div>

      {% if footer_actions %}
        <div class="modal-footer">
          {% for btn in footer_actions %}
            <button
              type="{{ btn.type | default('button') }}"
              class="btn btn-{{ btn.variant | default('ghost') }}"
              {% if btn.onclick %}onclick="{{ btn.onclick }}"{% endif %}
              {% if btn.close %}onclick="closeModal('{{ id }}')"{% endif %}
            >{{ btn.text }}</button>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
{% endmacro %}


{# Confirmation Modal #}
{% macro confirm_modal(
  id,
  title,
  message,
  icon_type='warning',
  confirm_text='Confirm',
  confirm_variant='primary',
  cancel_text='Cancel',
  class_name=''
) %}
  {% set icons = {
    'warning': '<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3M12 9v4M12 17h.01"/></svg>',
    'danger': '<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6M9 9l6 6"/></svg>',
    'success': '<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>',
    'info': '<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>'
  } %}

  <!-- Modal Backdrop -->
  <div class="modal-backdrop" id="{{ id }}-backdrop" onclick="closeModal('{{ id }}')"></div>

  <!-- Confirmation Modal -->
  <div class="modal modal-sm {{ class_name }}" id="{{ id }}" role="alertdialog" aria-modal="true" aria-labelledby="{{ id }}-title">
    <div class="modal-content">
      <div class="modal-body modal-confirm" style="padding: 32px;">
        <div class="modal-icon {{ icon_type }}">
          {{ icons.get(icon_type, icons.warning) | safe }}
        </div>
        <h3 class="modal-title" id="{{ id }}-title">{{ title }}</h3>
        <p class="modal-message">{{ message }}</p>
      </div>
      <div class="modal-footer" style="justify-content: center;">
        <button type="button" class="btn btn-ghost" onclick="closeModal('{{ id }}')">{{ cancel_text }}</button>
        <button type="button" class="btn btn-{{ confirm_variant }}" id="{{ id }}-confirm">{{ confirm_text }}</button>
      </div>
    </div>
  </div>
{% endmacro %}


{# Drawer (Side Panel) #}
{% macro drawer(
  id,
  title,
  position='right',
  size='md',
  show_close=true,
  class_name=''
) %}
  {% set size_class = 'drawer-lg' if size == 'lg' else 'drawer-full' if size == 'full' else '' %}
  {% set position_class = 'drawer-left' if position == 'left' else '' %}

  <!-- Drawer Backdrop -->
  <div class="modal-backdrop" id="{{ id }}-backdrop" onclick="closeDrawer('{{ id }}')"></div>

  <!-- Drawer -->
  <div class="drawer {{ position_class }} {{ size_class }} {{ class_name }}" id="{{ id }}" role="dialog" aria-modal="true" aria-labelledby="{{ id }}-title">
    <div class="modal-header">
      <h2 class="modal-title" id="{{ id }}-title">{{ title }}</h2>
      {% if show_close %}
        <button type="button" class="modal-close" onclick="closeDrawer('{{ id }}')" aria-label="Close">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6 6 18M6 6l12 12"/>
          </svg>
        </button>
      {% endif %}
    </div>
    <div class="modal-body" style="flex: 1; overflow-y: auto;">
      {{ caller() }}
    </div>
  </div>
{% endmacro %}


{# Bottom Sheet (Mobile) #}
{% macro sheet(
  id,
  title=none,
  show_handle=true,
  class_name=''
) %}
  <!-- Sheet Backdrop -->
  <div class="modal-backdrop" id="{{ id }}-backdrop" onclick="closeSheet('{{ id }}')"></div>

  <!-- Bottom Sheet -->
  <div class="sheet {{ class_name }}" id="{{ id }}" role="dialog" aria-modal="true">
    {% if show_handle %}
      <div class="sheet-handle"></div>
    {% endif %}
    {% if title %}
      <div class="modal-header">
        <h3 class="modal-title">{{ title }}</h3>
      </div>
    {% endif %}
    <div class="modal-body">
      {{ caller() }}
    </div>
  </div>
{% endmacro %}
