{#
  Action Bar Component

  Toolbar for bulk actions, filters, and view controls.

  Usage:
    {% from 'components/internal/action_bar.html' import action_bar %}
    {{ action_bar(
      filters=[
        {"name": "status", "options": [{"value": "all", "label": "All"}, ...]},
      ],
      actions=[
        {"label": "Export", "icon": "download", "onclick": "exportData()"},
      ],
      show_search=true,
      show_view_toggle=true
    ) }}

  Parameters:
    - filters: List of filter dropdowns
    - actions: List of action buttons
    - bulk_actions: List of bulk action buttons (shown when items selected)
    - show_search: Show inline search (default: false)
    - show_view_toggle: Show grid/list toggle (default: false)
    - selected_count: Number of selected items
    - class_name: Additional CSS classes
#}
{% from 'macros/icons.html' import icon %}

{% macro action_bar(
  filters=[],
  actions=[],
  bulk_actions=[],
  show_search=false,
  search_placeholder='Search...',
  show_view_toggle=false,
  current_view='list',
  selected_count=0,
  class_name=''
) %}
  <div class="action-bar {{ class_name }}" style="
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-4);
    padding: var(--space-3) var(--space-4);
    background: var(--color-gray-50);
    border: 1px solid var(--color-gray-200);
    border-radius: var(--radius-lg);
    margin-bottom: var(--space-4);
    flex-wrap: wrap;
  ">
    <!-- Left Side: Filters and Search -->
    <div style="display: flex; align-items: center; gap: var(--space-3); flex-wrap: wrap;">
      {% if show_search %}
        <div class="search-input" style="position: relative;">
          <span style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--color-gray-400);">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
            </svg>
          </span>
          <input
            type="search"
            class="form-input form-input-sm"
            placeholder="{{ search_placeholder }}"
            style="padding-left: 32px; width: 200px;"
          >
        </div>
      {% endif %}

      {% for filter in filters %}
        <select
          class="form-select form-select-sm"
          name="{{ filter.name }}"
          style="min-width: 120px;"
          {% if filter.onchange %}onchange="{{ filter.onchange }}"{% endif %}
        >
          {% for option in filter.options %}
            <option value="{{ option.value }}" {% if option.selected %}selected{% endif %}>
              {{ option.label }}
            </option>
          {% endfor %}
        </select>
      {% endfor %}

      {% if selected_count > 0 %}
        <div style="
          display: flex;
          align-items: center;
          gap: var(--space-2);
          padding: var(--space-1) var(--space-3);
          background: var(--color-primary-50);
          color: var(--color-primary-700);
          border-radius: var(--radius-md);
          font-size: var(--text-sm);
          font-weight: var(--font-medium);
        ">
          <span>{{ selected_count }} selected</span>
          {% for action in bulk_actions %}
            <button
              type="button"
              class="btn btn-sm btn-{{ action.variant | default('ghost') }}"
              {% if action.onclick %}onclick="{{ action.onclick }}"{% endif %}
            >
              {% if action.icon %}{{ icon(action.icon) }}{% endif %}
              {{ action.label }}
            </button>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <!-- Right Side: Actions and View Toggle -->
    <div style="display: flex; align-items: center; gap: var(--space-2);">
      {% for action in actions %}
        <button
          type="button"
          class="btn btn-sm btn-{{ action.variant | default('ghost') }}"
          {% if action.onclick %}onclick="{{ action.onclick }}"{% endif %}
          {% if action.href %}onclick="location.href='{{ action.href }}'"{% endif %}
        >
          {% if action.icon %}
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px;">
              {% if action.icon == 'download' %}
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
              {% elif action.icon == 'plus' %}
                <path d="M12 5v14M5 12h14"/>
              {% elif action.icon == 'filter' %}
                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
              {% elif action.icon == 'refresh' %}
                <path d="M1 4v6h6M23 20v-6h-6"/><path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4-4.64 4.36A9 9 0 0 1 3.51 15"/>
              {% endif %}
            </svg>
          {% endif %}
          {{ action.label }}
        </button>
      {% endfor %}

      {% if show_view_toggle %}
        <div class="btn-group btn-group-connected" style="margin-left: var(--space-2);">
          <button
            type="button"
            class="btn btn-sm {% if current_view == 'list' %}btn-primary{% else %}btn-ghost{% endif %}"
            onclick="setView('list')"
            title="List view"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/>
            </svg>
          </button>
          <button
            type="button"
            class="btn btn-sm {% if current_view == 'grid' %}btn-primary{% else %}btn-ghost{% endif %}"
            onclick="setView('grid')"
            title="Grid view"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
            </svg>
          </button>
        </div>
      {% endif %}
    </div>
  </div>
{% endmacro %}


{# Page Actions - Simple right-aligned action buttons #}
{% macro page_actions(actions=[], class_name='') %}
  <div class="page-actions {{ class_name }}" style="display: flex; gap: var(--space-3); flex-wrap: wrap;">
    {% for action in actions %}
      {% if action.href %}
        <a href="{{ action.href }}" class="btn btn-{{ action.variant | default('primary') }}">
          {% if action.icon %}{{ icon(action.icon) }}{% endif %}
          {{ action.label }}
        </a>
      {% else %}
        <button
          type="button"
          class="btn btn-{{ action.variant | default('primary') }}"
          {% if action.onclick %}onclick="{{ action.onclick }}"{% endif %}
        >
          {% if action.icon %}{{ icon(action.icon) }}{% endif %}
          {{ action.label }}
        </button>
      {% endif %}
    {% endfor %}
  </div>
{% endmacro %}
