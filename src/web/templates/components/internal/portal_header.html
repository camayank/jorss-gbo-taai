{#
  Portal Header

  Consistent header for internal portals with search, notifications, and actions.

  Usage:
    {% from 'components/internal/portal_header.html' import portal_header %}
    {{ portal_header(
      title='Dashboard',
      search_placeholder='Search clients...',
      show_notifications=true
    ) }}

  Parameters:
    - title: Page title
    - search_placeholder: Search input placeholder
    - search_action: Search form action URL (optional)
    - show_search: boolean (default: true)
    - show_notifications: boolean (default: true)
    - notification_count: Number of notifications
    - actions: HTML for header action buttons
    - user: User object
#}
{% from 'macros/icons.html' import icon %}

{% macro portal_header(
  title='Dashboard',
  search_placeholder='Search...',
  search_action=none,
  show_search=true,
  show_notifications=true,
  notification_count=0,
  actions=none,
  user=none
) %}
  <header class="page-header">
    <div class="page-title-section">
      <button class="hamburger-btn" onclick="toggleSidebar()" aria-label="Toggle menu">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 12h18M3 6h18M3 18h18"/>
        </svg>
      </button>
      <h1 class="page-title">{{ title }}</h1>
    </div>

    <div class="header-actions">
      {% if show_search %}
        <div class="search-input" style="display: none;">
          <span class="search-icon">{{ icon('magnifying-glass') }}</span>
          <input
            type="search"
            class="form-input"
            placeholder="{{ search_placeholder }}"
            id="globalSearch"
            {% if search_action %}data-action="{{ search_action }}"{% endif %}
          >
        </div>
        <div class="header-search">
          <span class="header-search-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
            </svg>
          </span>
          <input
            type="text"
            placeholder="{{ search_placeholder }}"
            id="headerSearch"
            style="width: 200px; padding: 8px 12px 8px 36px; border: 1px solid var(--color-gray-200); border-radius: 8px; font-size: 14px;"
            {% if search_action %}data-action="{{ search_action }}"{% endif %}
          >
        </div>
      {% endif %}

      {% if show_notifications %}
        <button class="header-btn" title="Notifications" id="notificationBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 0 1-3.46 0"/>
          </svg>
          {% if notification_count > 0 %}
            <span class="notification-dot"></span>
          {% endif %}
        </button>
      {% endif %}

      {% if actions %}
        {{ actions | safe }}
      {% endif %}

      <button class="header-btn" title="Settings" onclick="location.href='settings'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
      </button>
    </div>
  </header>

  <style>
    .page-header {
      background: var(--card-bg, white);
      border-bottom: 1px solid var(--color-gray-200);
      padding: 0 24px;
      height: var(--header-height, 64px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 40;
    }

    .page-title-section {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .hamburger-btn {
      display: none;
      background: none;
      border: none;
      padding: 8px;
      cursor: pointer;
      color: var(--color-gray-600);
      border-radius: var(--radius-md);
    }

    .hamburger-btn:hover {
      background: var(--color-gray-100);
    }

    .page-title {
      font-size: var(--text-xl);
      font-weight: var(--font-semibold);
      color: var(--color-gray-900);
      margin: 0;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header-search {
      position: relative;
    }

    .header-search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--color-gray-400);
      pointer-events: none;
    }

    .header-btn {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-lg);
      background: var(--color-gray-100);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-gray-500);
      position: relative;
      transition: all var(--transition-fast);
    }

    .header-btn:hover {
      background: var(--color-gray-200);
      color: var(--color-gray-700);
    }

    .notification-dot {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 8px;
      height: 8px;
      background: var(--color-error-500);
      border-radius: 50%;
    }

    @media (max-width: 1024px) {
      .hamburger-btn {
        display: flex;
      }

      .header-search {
        display: none;
      }
    }

    @media (max-width: 640px) {
      .page-header {
        padding: 0 16px;
      }

      .page-title {
        font-size: var(--text-lg);
      }
    }
  </style>

  <script>
    // Global search functionality
    const searchInput = document.getElementById('headerSearch');
    if (searchInput) {
      searchInput.addEventListener('keyup', function(e) {
        if (e.key === 'Enter' && this.value.trim()) {
          const action = this.dataset.action || '/search';
          window.location.href = action + '?q=' + encodeURIComponent(this.value.trim());
        }
      });
    }
  </script>
{% endmacro %}
